<!DOCTYPE HTML>
<html>
	<head>
		<style type="text/css">
			    body{
			     	color: #333;
			     	font-family: Arial, Helvetica, sans-serif;
			    }
			    #wrapper {
/* 				  margin-right: 700px; */
				}
				#chartContainer{
					max-height: 90vh;
				}
		</style>
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
	</head>
	<body>
		<p id="pDescription"></p>
		<div id="wrapper">
			<div class="row">
				<canvas id="chartContainer"></canvas>
			</div>
		</div>
		
		<script type="text/javascript">
		
			var websocket;
			var barchart;
			
			initChart();
			
			openWebsocket();
		
			function openWebsocket(){
				
				websocket = new WebSocket("ws://localhost:1234/timecollector/ws/v1");

				websocket.onopen = function(event) {
					websocket.send("Hi, I'm connected!");
				};

				websocket.onmessage = function(event) {
					var msg = JSON.parse(event.data);
// 					console.log(msg);
					switch (msg.type) {
						case "fulldata":
							document.getElementById("pDescription").innerHTML = msg.description;
							barchart.data.labels = msg.labels;
							barchart.data.datasets = msg.datasets;
							barchart.update();
							break;
					}
				}

			}

			function sendTextToServer(txt) {
				if(!websocket)return;
				// Send the msg object as a JSON-formatted string.
				websocket.send(JSON.stringify({
					type : "message",
					text : txt,
					date : Date.now()
				}));
			}

			function closeWebsocket(){
				if(!websocket)return;
				websocket.close();
			}
			
			function initChart() {
				var ctx = document.getElementById("chartContainer").getContext("2d");
				var data = {
					labels : [],
					datasets : []
				};

				barchart = new Chart(ctx, {
					type : 'bar',
					data : data,
					options : {
						animation:false,
						scales : {
							responsive : true,
							maintainAspectRatio : false,
							xAxes : [ {
								stacked : true
							} ],
							yAxes : [ {
								stacked : true,
								ticks : {
									beginAtZero : true
								}
							} ]
						}
					}
				});
			}
		</script>
	</body>
</html>