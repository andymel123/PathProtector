<!DOCTYPE HTML>
<html>
	<head>
		<style type="text/css">
			    body{
			     	color: #333;
			     	font-family: Arial, Helvetica, sans-serif;
			    }
			    #wrapper {
/* 				  margin-right: 700px; */
				}
				#chartContainer{
 					max-height: 90vh; 
				}
				canvas{
					
				}
		</style>
		

		<!-- for painting the chart -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.js"></script>
<!-- 		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.js"></script> -->
<!-- 		for writing the time-labels (x-axis) -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>
		<script src="testchartperf.js"></script>
		
	</head>
	<body>
		<p id="pDescription"></p>
		<div id="wrapper">
			<div class="row">
				<div id="chartContainer"></div>
			</div>
		</div>
		
		<script type="text/javascript">
		
			var chartsContainer = document.getElementById("chartContainer"); 
			var canvas = document.getElementById("cvs"); 
			var charts = {};
			
			startData();

			function handleServerEvent(msg){
				switch (msg.type) {
					case "fulldata": {
						
						// website layout (add one canvas per chart data if not already there)
						initCharts(msg.hashes);
						
						// update overall description
						document.getElementById("pDescription").innerHTML = msg.description;
						
 						// update all charts
						var graphsArray = msg.graphData;
						for (i = 0; i < graphsArray.length; ++i) {
						    var graphData = graphsArray[i];
					
 						    // TODO write/update chart description

 						    document.getElementById("pDescription").innerHTML = graphData.description;  
 							   
							// update the right chart
							var hashId = getIdFromHash(graphData.hash);
							var chartOfHash = charts[hashId];
							if(chartOfHash && chartOfHash.data){
							    chartOfHash.data.labels = convertLabels(graphData.labels);
								chartOfHash.data.datasets = graphData.datasets;
								chartOfHash.update();
							}else{
								console.error("chart of hash '"+hashId+" is not valid!", chartOfHash);
							}
						}		
						break;
					}
				}

			}
			
			function getIdFromHash(hash){
				return "cvs"+hash;
			}
			
			function initCharts(hashesArray) {
				
				for (i = 0; i < hashesArray.length; ++i) {
				    var hashId = getIdFromHash(hashesArray[i]);
					
				    var canvas = document.getElementById(hashId);
				    if(canvas){
				    	// we alread have a chart for this path
				    	continue;
				    }else{
				    	var canvas = document.createElement('canvas');
						chartsContainer.appendChild(canvas);
				    	canvas.id = hashId;
				    	canvas.width = 2000;
				    	canvas.height= 250;
				    	
						var ctx = canvas.getContext("2d");
						var data = {
							labels: ["588240774","588255460","588267871","588281084","588292538","588304214","588313542","588322610","588334797","588347127","588358898","588370651","588381989","588395061","588408192","588420662","588430957","588444045","588454444","588465749","588478186","588487950","588499212","588510241","588522328","588536270","588548884","588563616","588577445","588587721","588599567","588611610","588620783","588632390","588644165","588655312","588668109","588680763","588692906","588704188","588718035","588726038","588737938","588751213","588765867","588777806","588788115","588801446","588812409","588825510","588836977","588850478","588863428","588875347","588888715","588897507","588907242","588917966","588929088","588940178","588952091","588963218","588974808","588985314","588998478","589010158","589020899","589033463","589046232","589057872","589073225","589087272","589100064","589112188","589124954","589137391","589152941","589164618","589176178","589190027","589202130","589214389","589225143","589235843","589246830","589258110","589270753","589282675","589295619","589308737","589322531","589336478","589346240","589358711","589370428","589381633","589392330","589404366","589416188","589427793","589442359"],
							datasets: [{label:"CREATION => BEFORE_HANDLER_CONTEXT", backgroundColor: "#000000", borderColor: "#FFFFFF", data: [,40,732,279,670,120,318,948,123,410,403,622,500,852,443,89,429,339,567,53,100,467,449,613,690,775,745,781,737,747,306,125,380,300,531,299,9,990,917,862,209,604,187,537,969,884,880,33,884,495,538,915,491,996,376,288,37,578,769,702,70,12,289,413,618,903,674,301,788,144,767,451,471,567,972,93,640,173,676,901,213,753,479,517,292,770,513,609,751,504,469,124,169,26,374,484,381,997,671,726,860,448]},{label:"BEFORE_HANDLER_CONTEXT => BEFORE_SEARCH_HANDLER", backgroundColor: "#ff0000", borderColor: "#FFFFFF", data: [,275,158,191,818,355,922,210,165,10,872,503,411,395,598,587,268,782,907,800,960,733,144,273,140,95,872,479,323,432,571,138,571,194,852,288,630,832,274,84,93,254,500,83,25,237,515,128,983,293,878,842,817,367,911,412,448,273,476,321,713,964,412,59,573,819,129,606,722,762,856,531,991,677,515,816,660,856,29,725,632,73,881,150,73,751,991,816,30,649,50,404,685,405,361,554,712,789,30,918,849,571]},{label:"BEFORE_SEARCH_HANDLER => AFTER_SEARCH_HANDLER", backgroundColor: "#00ff00", borderColor: "#FFFFFF", data: [,87,729,786,858,75,461,638,407,9,432,366,259,334,141,605,781,236,358,360,304,963,344,308,922,40,191,149,859,753,362,884,231,619,772,865,66,330,936,946,198,415,335,633,493,881,898,687,281,16,696,115,418,822,559,315,220,640,255,949,210,592,991,218,705,727,456,704,971,806,648,504,618,211,237,791,690,973,132,643,901,710,572,177,390,449,22,500,472,770,868,980,928,102,460,925,292,250,563,821,506,156]},{label:"AFTER_SEARCH_HANDLER => BEFORE_HANDLER", backgroundColor: "#0000ff", borderColor: "#FFFFFF", data: [,430,518,304,689,196,705,167,387,555,72,307,439,673,857,842,589,784,75,729,271,214,79,274,394,105,872,992,906,772,262,664,238,361,367,354,700,855,819,478,187,819,577,675,389,338,39,321,335,248,758,254,139,47,604,14,235,303,921,545,218,526,751,355,73,507,32,37,118,399,711,998,766,711,285,180,154,758,507,170,185,583,266,89,380,336,469,430,330,284,835,516,390,687,239,629,786,740,675,43,597,966]},{label:"BEFORE_HANDLER => BEFORE_DAO_GETSTATE", backgroundColor: "#ffff00", borderColor: "#FFFFFF", data: [,915,815,508,182,883,814,197,620,738,296,236,438,845,508,214,925,981,70,332,317,984,993,499,658,486,128,776,480,399,299,927,519,341,958,502,276,780,354,681,430,21,168,255,248,282,24,824,601,812,460,331,636,380,243,771,513,877,990,178,804,536,847,508,214,752,296,519,699,424,632,697,635,463,15,31,914,790,693,823,684,694,575,799,762,480,102,372,915,108,590,948,5,219,196,59,550,153,311,582,9,842]},{label:"BEFORE_DAO_GETSTATE => BEFORE_DBPOOL", backgroundColor: "#00ffff", borderColor: "#FFFFFF", data: [,89,885,225,95,901,30,242,352,558,965,733,652,425,260,966,166,385,885,598,539,591,16,409,551,994,625,352,911,349,769,148,577,512,928,496,243,662,209,964,375,601,16,212,962,864,29,41,78,121,47,72,636,242,46,372,490,43,196,699,438,191,377,174,764,719,595,253,62,875,197,379,462,750,368,440,865,465,962,269,305,610,54,394,862,678,683,864,285,719,716,138,471,136,948,792,213,432,298,981,58,823]},{label:"BEFORE_DBPOOL => AFTER_DBPOOL", backgroundColor: "#ff00ff", borderColor: "#FFFFFF", data: [,365,565,754,471,5,272,102,564,850,1,145,50,41,914,343,440,6,725,557,792,234,167,379,248,572,899,512,989,959,306,830,312,66,319,306,581,670,806,129,807,431,190,468,607,155,285,598,621,373,973,415,979,550,657,114,159,55,531,580,262,555,127,521,285,507,448,272,520,366,991,526,486,126,816,721,333,371,577,341,739,560,363,25,851,478,655,755,592,733,743,110,10,856,330,732,267,52,995,472,97,905]},{label:"AFTER_DBPOOL => BEFORE_DB_GETSTATE", backgroundColor: "#808080", borderColor: "#FFFFFF", data: [,985,782,755,708,904,485,153,777,168,117,822,680,474,488,231,983,304,804,860,759,143,236,606,340,473,851,417,17,443,204,496,439,464,102,319,79,57,735,923,844,862,176,613,722,404,624,337,750,118,889,175,870,688,485,272,80,839,393,700,365,685,696,327,187,532,352,796,345,278,104,619,789,502,920,521,104,757,351,95,996,109,965,645,515,437,939,932,597,27,525,986,804,157,175,934,47,144,143,193,807,538]},{label:"BEFORE_DB_GETSTATE => AFTER_DB_GETSTATE", backgroundColor: "#ff8080", borderColor: "#FFFFFF", data: [,139,79,452,573,413,646,31,179,953,36,59,230,120,747,664,970,140,940,211,60,673,370,634,150,60,635,926,132,700,914,522,157,996,593,237,30,458,86,20,548,892,115,789,625,922,225,981,647,26,702,408,476,308,311,294,385,261,616,62,669,791,87,698,587,958,917,186,147,839,817,735,614,840,358,886,909,970,99,82,566,972,779,341,418,37,658,952,569,741,797,607,563,627,83,419,774,853,847,983,301,275]},{label:"AFTER_DB_GETSTATE => AFTER_DAO_GETSTATE", backgroundColor: "#80ff80", borderColor: "#FFFFFF", data: [,254,664,300,253,623,532,815,268,545,578,54,497,428,403,972,923,220,451,695,802,373,735,579,58,420,996,59,511,13,681,492,454,238,270,537,530,383,103,436,514,867,556,294,277,457,569,770,625,550,978,202,594,668,617,944,410,213,185,315,801,8,791,179,611,358,560,294,631,346,139,999,108,473,155,363,231,881,173,843,998,723,409,685,49,394,287,109,729,832,686,806,732,329,517,527,505,583,244,109,808,689]},{label:"AFTER_DAO_GETSTATE => BEFORE_CALC1", backgroundColor: "#8080ff", borderColor: "#FFFFFF", data: [,823,519,781,690,150,118,37,246,803,593,200,463,568,956,925,468,34,917,898,641,200,94,428,293,495,326,885,870,473,106,344,614,236,965,780,890,780,523,131,858,118,804,110,935,546,773,302,867,738,869,278,210,986,304,17,524,377,244,749,554,975,448,276,709,839,94,411,528,451,903,596,855,77,307,396,156,476,808,120,540,791,604,926,367,37,883,336,682,547,92,784,947,280,561,307,210,200,863,541,648,543]},{label:"BEFORE_CALC1 => AFTER_CALC1", backgroundColor: "#008080", borderColor: "#FFFFFF", data: [,128,902,205,799,611,738,89,51,808,462,128,212,451,815,529,991,3,261,652,236,575,232,568,87,346,499,570,833,42,481,472,517,881,259,45,638,754,255,481,203,131,329,729,282,771,396,5,512,613,858,887,784,36,181,576,467,126,694,590,674,761,70,382,497,29,88,472,713,244,318,853,999,189,543,857,247,852,805,583,900,475,886,154,570,388,160,689,534,905,594,490,202,566,510,494,34,530,383,757,324,695]},{label:"AFTER_CALC1 => BEFORE_DECIDER", backgroundColor: "#800080", borderColor: "#FFFFFF", data: [,82,940,377,758,245,585,372,564,970,413,3,988,43,289,258,443,831,315,594,926,101,213,258,449,800,705,852,858,446,152,183,751,325,178,599,349,751,715,894,547,980,167,170,149,746,256,101,93,743,164,986,414,336,784,971,242,448,671,151,653,970,826,884,274,693,56,104,31,402,568,968,355,384,861,570,829,816,604,768,159,559,25,420,393,268,756,706,818,728,667,855,355,573,614,272,341,185,551,754,97,543]},{label:"BEFORE_DECIDER => AFTER_DECIDER", backgroundColor: "#808000", borderColor: "#FFFFFF", data: [,175,250,632,317,794,233,9,200,95,594,809,823,809,503,47,682,460,667,6,637,778,766,103,613,688,10,733,438,978,343,865,276,4,539,528,755,584,209,24,724,864,388,899,516,182,790,212,435,589,209,236,473,38,541,963,517,274,559,117,238,1,61,571,720,493,256,698,945,416,162,840,157,730,521,984,920,635,814,721,367,569,733,974,112,161,538,133,106,479,773,576,841,677,711,829,216,368,850,421,467,240]},{label:"AFTER_DECIDER => BEFORE_DAO_SAVE", backgroundColor: "#ffff80", borderColor: "#FFFFFF", data: [,32,429,276,299,947,134,179,706,547,644,650,552,915,976,503,475,490,369,568,260,971,424,517,883,809,982,85,581,401,323,378,933,111,435,148,95,436,277,865,146,591,418,887,922,617,821,425,816,968,263,352,305,304,357,906,190,179,472,277,23,115,122,780,192,108,410,624,921,387,44,982,245,769,606,395,570,671,917,897,955,710,677,559,394,698,341,131,540,517,268,635,568,365,680,593,467,732,463,538,788,494]},{label:"BEFORE_DAO_SAVE => BEFORE_DBPOOL", backgroundColor: "#80ffff", borderColor: "#FFFFFF", data: [,643,97,871,741,364,81,982,495,297,693,807,206,95,290,784,196,559,409,165,330,472,298,904,534,715,623,29,824,273,295,411,629,32,621,826,39,241,305,543,810,364,53,263,428,625,449,249,358,907,869,266,880,917,959,686,317,728,712,558,825,152,682,439,562,462,516,838,447,564,175,217,972,617,663,682,65,410,400,275,294,192,949,79,671,822,315,912,232,930,530,9,951,713,959,685,114,146,938,26,904,551]},{label:"BEFORE_DBPOOL => AFTER_DBPOOL", backgroundColor: "#ff80ff", borderColor: "#FFFFFF", data: [,618,764,127,733,896,96,919,124,189,699,307,337,484,415,712,136,675,490,102,9,175,960,925,120,346,484,821,812,687,562,337,447,29,224,881,401,136,942,563,388,791,5,770,668,722,999,810,265,226,159,615,223,18,535,722,468,20,786,943,120,478,732,871,247,787,708,484,381,779,964,588,925,842,276,538,119,377,914,59,934,362,939,16,817,106,25,800,788,983,441,880,666,70,852,428,914,15,305,240,510,441]},{label:"AFTER_DBPOOL => BEFORE_DB_SAVE_DECISION1", backgroundColor: "#ff0080", borderColor: "#FFFFFF", data: [,245,930,919,623,339,569,480,625,889,649,793,327,301,444,566,40,701,466,537,173,637,697,490,731,267,476,270,884,708,868,487,994,845,602,114,998,201,917,36,402,948,86,773,911,405,423,922,805,414,737,695,968,915,916,521,76,507,262,3,876,108,129,368,188,164,989,305,867,360,123,801,183,479,686,421,468,886,178,305,25,316,239,550,872,721,2,938,770,118,664,324,67,640,973,485,528,35,723,370,718,647]},{label:"BEFORE_DB_SAVE_DECISION1 => AFTER_DB_SAVE_DECISION1", backgroundColor: "#80ff00", borderColor: "#FFFFFF", data: [,302,830,757,870,21,692,280,63,53,744,996,679,478,783,866,952,180,929,187,394,424,407,783,78,390,373,813,174,476,514,852,247,243,245,219,709,252,428,114,415,337,384,436,689,690,547,851,998,109,724,500,401,844,152,311,823,224,132,325,402,630,182,215,207,571,477,817,351,788,128,992,698,738,552,392,888,271,289,497,652,241,338,597,262,37,899,37,44,42,286,839,842,169,872,10,990,859,103,209,245,905]},{label:"AFTER_DB_SAVE_DECISION1 => AFTER_DAO_SAVE", backgroundColor: "#0080ff", borderColor: "#FFFFFF", data: [,78,422,12,293,45,238,148,632,745,994,817,682,373,106,479,296,793,827,784,640,347,488,228,233,873,170,549,609,804,203,750,129,759,88,593,935,646,682,948,811,552,660,251,68,846,814,349,691,802,57,734,280,837,253,786,681,701,63,623,663,599,466,994,34,241,108,99,50,811,693,651,23,181,995,663,212,735,220,730,575,314,136,579,18,731,537,194,319,758,223,666,991,60,265,294,256,744,958,944,512,754]},{label:"AFTER_DAO_SAVE => AFTER_HANDLER", backgroundColor: "#00ff80", borderColor: "#FFFFFF", data: [,594,35,451,781,440,965,382,37,800,713,266,487,610,948,556,77,173,449,49,765,997,145,44,817,916,868,303,543,681,808,933,925,536,702,839,856,427,867,451,161,900,802,434,287,920,384,64,148,941,605,660,453,900,898,743,448,487,201,185,365,592,96,585,63,752,754,112,282,643,223,2,333,694,645,335,574,912,121,541,210,110,219,389,72,174,124,465,229,502,723,725,848,853,322,623,582,264,297,205,360,943]},{label:"AFTER_HANDLER => AFTER_HANDLER_CONTEXT", backgroundColor: "#8000ff", borderColor: "#FFFFFF", data: [,963,972,953,296,876,624,749,994,450,874,435,400,304,952,63,917,291,644,31,708,756,515,670,955,430,761,332,298,983,241,49,736,658,173,873,405,103,579,763,774,892,115,556,380,665,322,387,915,81,305,759,986,250,400,886,157,707,255,572,280,447,909,486,477,466,973,854,672,90,582,541,585,688,516,231,916,884,7,43,950,688,137,361,943,435,744,414,189,241,234,164,327,516,42,252,177,715,141,12,227,577]}]
						};

						var barchart = new Chart(ctx, {
							type : 'bar',
							data : data,
							options : {
								legend: {
							        display: true,
							        position: "left",
							        labels:{
							        	fontSize: 9
							        }
							    },
								animation:false,
								scales : {
									responsive : true,
									maintainAspectRatio : false,
									xAxes : [ {
										stacked : true
									} ],
									yAxes : [ {
										stacked : true,
										ticks : {
											beginAtZero : true
										}
									} ]
								}
							}
						});
						// save chart in dictonary
						charts[hashId] = barchart;
						
						// finally append the new canvas into the chartsContainer
				    }
				}
			}
			
			function convertLabels(msg_labels){
				return msg_labels.map(ms => {
					var d = new Date(ms);
					var sep=":";
					var s = d.getUTCHours();
					s+=sep;
					s+=d.getUTCMinutes();
					s+=sep;
					s+=d.getSeconds();
					s+=sep;
					s+=d.getMilliseconds();
					return s;
				})
			}
			
			function get_browser() {
				// from http://stackoverflow.com/a/16938481
			    var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || []; 
			    if(/trident/i.test(M[1])){
			        tem=/\brv[ :]+(\d+)/g.exec(ua) || []; 
			        return {name:'IE',version:(tem[1]||'')};
			        }   
			    if(M[1]==='Chrome'){
			        tem=ua.match(/\bOPR|Edge\/(\d+)/)
			        if(tem!=null)   {return {name:'Opera', version:tem[1]};}
			        }   
			    M=M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
			    if((tem=ua.match(/version\/(\d+)/i))!=null) {M.splice(1,1,tem[1]);}
			    return {
			      name: M[0],
			      version: M[1]
			    };
			 }
			
		</script>
	</body>
</html>